// ==========================================
// ğŸ› ï¸ ç³»ç»Ÿé…ç½® (Configuration)
// ==========================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ==========================================
// ğŸ” æƒé™ä¸è§’è‰² (Auth Enums)
// ==========================================

enum Role {
  ADMIN // æ€»éƒ¨ç®¡ç†å‘˜ (å…¬å¸å‘˜å·¥)
  OWNER // ä¿±ä¹éƒ¨è´Ÿè´£äºº (é“åœºé¦†é•¿)
}

enum ApplicationStatus {
  pending   // æœªå¤„ç†
  contacted // å·²è”ç³»
  joined    // å·²å…¥ä¼š
  rejected  // å·²å–æ¶ˆ/æ‹’ç»
}

// ==========================================
// ğŸ‘¤ ç”¨æˆ·ç³»ç»Ÿ (Users)
// ==========================================

model User {
  id        String   @id // å»ºè®®å¯¹æ¥ Auth ç³»ç»Ÿçš„ ID
  email     String   @unique
  name      String?
  role      Role     @default(OWNER)

  // é¦†é•¿å…³è”çš„ä¿±ä¹éƒ¨ (ä¸€å¯¹å¤šå…³ç³»)
  // å¦‚æœæ‚¨å¸Œæœ›ä¸€ä¸ªç”¨æˆ·åªèƒ½æ‹¥æœ‰ä¸€ä¸ªä¿±ä¹éƒ¨ï¼Œè¯·å»æ‰ [] å¹¶å°† clubId ç§»å› User è¡¨
  // ä½†æ—¢ç„¶æ‚¨ä¹‹å‰çš„ Schema é‡Œ User.clubId æ˜¯ unique çš„ï¼Œé‚£æˆ‘ä»¬ä¿æŒä¸€å¯¹ä¸€å…³ç³»æ›´ç®€å•ï¼š
  // ä¿®æ­£æ–¹æ¡ˆï¼šä¿æŒ User.clubId ä½œä¸ºå¤–é”®å¯èƒ½å¯¼è‡´å¾ªç¯ä¾èµ–ï¼Œé€šå¸¸åšæ³•æ˜¯ Club.ownerId ä½œä¸ºå¤–é”®ã€‚
  // ä¸‹é¢é‡‡ç”¨æ ‡å‡†çš„ã€ä¸€ä¸ª User æ‹¥æœ‰å¤šä¸ª Clubã€‘çš„å†™æ³•ï¼Œå…¼å®¹æ€§æœ€å¼ºï¼š
  clubs     Club[]   @relation("ClubOwner")

  // å‘å¸ƒè®°å½•
  activities Activity[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ==========================================
// ğŸ›ï¸ ä¿±ä¹éƒ¨æ ¸å¿ƒèµ„äº§ (Clubs)
// ==========================================

model Club {
  id             String    @id @default(cuid())
  name           String
  slug           String    @unique
  description    String?   @db.Text
  logo           String?
  mainImage      String?
  subImages      String[] // å‰¯å›¾æ•°ç»„

  // æ‰€åœ¨åœ°ä¿¡æ¯
  zipCode        String?   // éƒµä¾¿ç•ªå·
  area           String    // éƒ½é“åºœçœŒ (å¿…é¡»)
  city           String?   // å¸‚åŒºç”ºæ‘
  address        String    // ç•ªåœ° (å¿…é¡»)
  mapUrl         String?   @db.Text // Google Maps é“¾æ¥

  // è”ç»œä¿¡æ¯
  phone          String?
  email          String?
  website        String?
  instagram      String?
  twitter        String?

  // è¿è¥ä¿¡æ¯
  schedule       String?   // ç¨½å¤æ—¶é—´ (JSON String)
  target         String?   // å‹Ÿé›†å¯¹è±¡
  representative String?   // ä»£è¡¨è€…

  // å…³ç³»é“¾è·¯ï¼šæ‰€æœ‰æƒ
  ownerId        String?   // å…è®¸ä¸ºç©ºï¼Œå› ä¸ºå¯èƒ½æœ‰ä¿±ä¹éƒ¨æš‚æ—¶æ²¡æœ‰åˆ†é… owner
  owner          User?     @relation("ClubOwner", fields: [ownerId], references: [id])

  // å…¶ä»–å…³ç³»
  activities     Activity[]
  applications   Application[] // å…³è”çš„ç”³è¯·è®°å½•
  published      Boolean   @default(false) // é»˜è®¤ä¸º false (è‰ç¨¿çŠ¶æ€)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  @@index([area]) // ä¼˜åŒ–æŒ‰åœ°åŒºæŸ¥è¯¢çš„æ€§èƒ½
}

// ==========================================
// ğŸ“ å†…å®¹ä¸æ´»åŠ¨ (Activities / News)
// ==========================================

model Activity {
  id           String   @id @default(cuid())
  title        String
  slug         String   @unique
  date         DateTime
  location     String?
  category     String   @default("Report")
  mainImage    String?
  published    Boolean  @default(true)

  // æ¨¡ç‰ˆåˆ†å‘é€»è¾‘
  templateType String   @default("news") // news, report, event, custom
  contentData  Json?    // ç»“æ„åŒ–ç§¯æœ¨æ•°æ®
  content      String?  @db.Text // çº¯æ–‡æœ¬å¤‡ä»½ (SEO ä¼˜åŒ–)

  // å½’å±ä¿¡æ¯
  clubId       String
  club         Club     @relation(fields: [clubId], references: [id], onDelete: Cascade)
  authorId     String
  author       User     @relation(fields: [authorId], references: [id])

  customRoute  String?  // æ‰‹å†™ç²¾è£…é¡µé¢çš„è·¯ç”± ID

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([clubId])
  @@index([category])
}

// ==========================================
// ğŸ“š æ•°å­—åŒ–èµ„äº§ (Magazines & Banners)
// ==========================================

model Magazine {
  id          String   @id @default(cuid())
  title       String   // æ‚å¿—æ ‡é¢˜ï¼Œå¦‚ï¼šç›¸æ‰‘æœˆåˆŠ Vol.15
  slug        String   @unique // ç”¨äº URL çš„å”¯ä¸€æ ‡è¯†
  description String?  @db.Text // ç®€çŸ­æè¿°æˆ–æœ¬æœŸçœ‹ç‚¹
  region      String   @default("All") // ç”¨äºåœ°åŒºç­›é€‰ (ä¾‹å¦‚ï¼šå…¨å›½, é–¢æ±, é–¢è¥¿)
  coverImage  String?  // å°é¢å›¾ URL
  images      String[] //å†…é¡µå›¾ç‰‡æ•°ç»„
  pdfUrl      String?  // PDF æ–‡ä»¶ä¸‹è½½é“¾æ¥
  readLink    String?  // åœ¨çº¿é˜…è¯»é“¾æ¥ï¼ˆå¦‚æœä½¿ç”¨çš„æ˜¯å¤–éƒ¨ç¿»é¡µå·¥å…·ï¼‰
  
  issueDate   DateTime @default(now()) // æ‚å¿—æ‰€å±çš„æœŸæ•°æ—¥æœŸ
  published   Boolean  @default(true)  // å‘å¸ƒçŠ¶æ€å¼€å…³

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([issueDate]) // ä¸ºæ—¥æœŸæ·»åŠ ç´¢å¼•ï¼Œæé«˜åˆ—è¡¨æŸ¥è¯¢æ€§èƒ½
  @@index([region]) // ä¸ºç­›é€‰å­—æ®µæ·»åŠ ç´¢å¼•
}

model Banner {
  id        String   @id @default(cuid())
  name      String
  image     String
  alt       String?
  link      String?
  sortOrder Int      @default(0)
  isActive  Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ==========================================
// ğŸ“© ä¸šåŠ¡è½¬åŒ–ï¼šå…¥ä¼šç”³è¯· (Applications)
// ==========================================

model Application {
  id         String            @id @default(cuid())
  
  // å…³è”é“åœº
  clubId     String
  club       Club              @relation(fields: [clubId], references: [id], onDelete: Cascade)
  clubName   String            // å†—ä½™å­˜å‚¨ï¼Œé˜²æ­¢é“åœºæ”¹ååæ‰¾ä¸åˆ°å†å²è®°å½•

  // ç”³è¯·äººä¿¡æ¯
  name       String
  email      String
  phone      String?
  experience String            // beginner, experienced
  message    String?           @db.Text
  
  // çŠ¶æ€ç®¡ç† (ä½¿ç”¨ Enum ç¡®ä¿ç±»å‹å®‰å…¨)
  status     ApplicationStatus @default(pending)

  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @updatedAt

  @@index([clubId])
  @@index([status])
}

// ==========================================
// ğŸ“¬ é€šç”¨è¯¢é—® (Contact Form Inquiries)
// ==========================================

enum InquiryStatus {
  unread    // æœªèª­
  read      // ç¢ºèªæ¸ˆã¿
  replied   // è¿”ä¿¡æ¸ˆã¿
  closed    // å¯¾å¿œå®Œäº†
}

model Inquiry {
  id           String        @id @default(cuid())
  
  // è¯¢é—®äººä¿¡æ¯
  name         String        // ãŠåå‰
  furigana     String?       // ãƒ•ãƒªã‚¬ãƒŠ
  email        String        // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
  phone        String?       // é›»è©±ç•ªå·
  
  // è¯¢é—®å†…å®¹
  inquiryType  String        // ãŠå•ã„åˆã‚ã›ç¨®åˆ¥
  message      String        @db.Text // ãŠå•ã„åˆã‚ã›å†…å®¹
  
  // çŠ¶æ€ç®¡ç†
  status       InquiryStatus @default(unread)
  
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  @@index([status])
  @@index([createdAt])
}